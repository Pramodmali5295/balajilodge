                              {/* Section 2: Stay Details */}
                              <div className="space-y-5">
                                  <div className="flex items-center gap-3 pb-3 border-b-2 border-emerald-100">
                                      <div className="p-2 bg-emerald-100 rounded-lg">
                                          <BedDouble size={20} className="text-emerald-600" />
                                      </div>
                                      <h3 className="text-lg font-bold text-gray-900">Stay Details</h3>
                                  </div>

                                  {/* Row 1: Arrival Date, Departure Date */}
                                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                     <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Arrival Date</label>
                                        <input type="datetime-local" name="checkIn" value={formData.checkIn} onChange={handleChange} className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm transition-all" required />
                                     </div>
                                     <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Departure Date</label>
                                        <input 
                                           type="datetime-local" 
                                           name="checkOut" 
                                           value={formData.checkOut} 
                                           onChange={(e) => {
                                              const newCheckOut = e.target.value;
                                              const diffTime = Math.abs(new Date(newCheckOut) - new Date(formData.checkIn));
                                              const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                                              setFormData(prev => ({ ...prev, checkOut: newCheckOut, stayDuration: diffDays || 1 }));
                                           }}
                                           className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-base transition-all" 
                                        />
                                     </div>
                                  </div>

                                  {/* Row 2: Booking Done By, Booking ID */}
                                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                      <div>
                                         <label className="block text-sm font-semibold text-gray-700 mb-2">Booking Done By</label>
                                         <select name="employeeId" value={formData.employeeId} onChange={handleChange} className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-base transition-all" required>
                                            <option value="">Select Staff</option>
                                            {employees.map(e => <option key={e.id} value={e.id}>{e.name}</option>)}
                                         </select>
                                      </div>
                                      <div>
                                         <label className="block text-sm font-semibold text-gray-700 mb-2">Booking ID</label>
                                         <input type="text" name="externalBookingId" value={formData.externalBookingId} onChange={handleChange} className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-base transition-all" placeholder="Optional" />
                                      </div>
                                  </div>

                                  {/* Row 3: Select Rooms, Number of Persons */}
                                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                     <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Select Rooms</label>
                                        <select 
                                           value={formData.roomIds[0] || ''} 
                                           onChange={(e) => {
                                              const selectedId = e.target.value;
                                              if (selectedId) {
                                                 // Find the selected room and set its type
                                                 const selectedRoom = rooms.find(r => r.id === selectedId);
                                                 if (selectedRoom) {
                                                    setSelectedRoomType(selectedRoom.type);
                                                 }
                                                 setFormData(prev => ({ ...prev, roomIds: [selectedId] }));
                                              } else {
                                                 setFormData(prev => ({ ...prev, roomIds: [] }));
                                              }
                                           }}
                                           className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-base transition-all"
                                        >
                                           <option value="">Select a Room</option>
                                           {rooms
                                              .filter(r => {
                                                 // Filter out booked rooms
                                                 const isBooked = r.status === 'Booked';
                                                 const hasActiveAllocation = allocations.some(a => 
                                                    String(a.roomId) === String(r.id) && 
                                                    (a.status === 'Active' || !a.status)
                                                 );
                                                 return !isBooked && !hasActiveAllocation;
                                              })
                                              .map(r => (
                                                 <option key={r.id} value={r.id}>
                                                    {r.roomNumber} - {r.type}
                                                 </option>
                                              ))
                                           }
                                        </select>
                                     </div>
                                     <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Number of Persons</label>
                                        <input type="number" name="numberOfGuests" value={formData.numberOfGuests} onChange={handleChange} min="1" max="10" className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-base transition-all" placeholder="1" required />
                                     </div>
                                  </div>

                                  {/* Row 4: Number of Days, Booking Type */}
                                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                      <div>
                                         <label className="block text-sm font-semibold text-gray-700 mb-2">Number of Days</label>
                                         <input 
                                            type="number" 
                                            name="stayDuration" 
                                            value={formData.stayDuration} 
                                            onChange={(e) => {
                                               const val = e.target.value;
                                               if (val === '') { setFormData(prev => ({ ...prev, stayDuration: '' })); return; }
                                               const days = parseInt(val) || 0;
                                               if (days < 1) return;
                                               const checkInDate = new Date(formData.checkIn);
                                               const newCheckOut = new Date(checkInDate.getTime() + days * 24 * 60 * 60 * 1000);
                                               const tzOffset = newCheckOut.getTimezoneOffset() * 60000;
                                               setFormData(prev => ({ ...prev, stayDuration: days, checkOut: new Date(newCheckOut.getTime() - tzOffset).toISOString().slice(0, 16) }));
                                            }} 
                                            min="1" 
                                            className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-base transition-all" 
                                         />
                                      </div>
                                      <div>
                                         <label className="block text-sm font-semibold text-gray-700 mb-2">Booking Type</label>
                                         <div className="flex gap-2">
                                            <select 
                                               name="bookingPlatform" 
                                               value={formData.bookingPlatform} 
                                               onChange={handleChange} 
                                               className="flex-1 px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-base transition-all" 
                                            >
                                               {bookingSources.map(source => (
                                                  <option key={source} value={source}>{source}</option>
                                               ))}
                                            </select>
                                            <button
                                               type="button"
                                               onClick={() => setShowAddSourceModal(true)}
                                               className="px-4 py-3 bg-indigo-50 border border-indigo-100 text-indigo-700 hover:bg-indigo-100 rounded-lg font-bold text-base transition-all flex items-center gap-2"
                                               title="Add New Source"
                                            >
                                               <Plus size={18} />
                                            </button>
                                         </div>
                                      </div>
                                  </div>

                                  {/* Row 5: Room Type */}
                                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                     <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Room Type</label>
                                        <select 
                                           value={selectedRoomType} 
                                           onChange={(e) => { setSelectedRoomType(e.target.value); setFormData(prev => ({...prev, roomIds: []})); }} 
                                           className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-base transition-all"
                                        >
                                           <option value="">Select Room Type</option>
                                           {['AC', 'Non-AC'].map(type => <option key={type} value={type}>{type}</option>)}
                                        </select>
                                     </div>
                                  </div>
                              </div>

